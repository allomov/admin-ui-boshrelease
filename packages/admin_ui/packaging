# abort script on any command that exits with a non zero value
set -e -x

ls -lha
pwd

cp -a admin_ui ${BOSH_INSTALL_TARGET}
cd ${BOSH_INSTALL_TARGET}/admin_ui

ls -lha
pwd

libpq_dir=/var/vcap/packages/libpq
bundle_cmd="/var/vcap/packages/ruby/bin/bundle"

$bundle_cmd config build.pg --with-pg-lib=$libpq_dir/lib --with-pg-include=$libpq_dir/include
$bundle_cmd install \
  --local \
  --deployment \
  --without development test
  --no-prune
  # --binstubs ${BOSH_INSTALL_TARGET}/bin \
  # --path ${BOSH_INSTALL_TARGET}/gem_home


# /var/vcap/packages/ruby/bin/bundle install --deployment \
#                                            --without=development test \
#                                            --with-pg-lib=/var/vcap/packages/libpq/lib \
#                                            --with-pg-config=/var/vcap/packages/libpq/bin/pg_config




cd ${BOSH_INSTALL_TARGET}
cp -a ${BOSH_COMPILE_TARGET}/vcap-common vcap-common
cd vcap-common
/var/vcap/packages/ruby/bin/bundle install --local --deployment --without=development test